import{r as a,o as e,e as l,g as o,h as r,k as t,a4 as u,I as s,aL as n,au as i,aw as d,ay as v,f as p,aM as c,i as f,aN as _,a1 as m,j as w,p as b,v as h,F as g,a7 as k,a2 as y,am as x,an as C,aR as I,a0 as U,ax as z}from"./vendor-DLaggKmm.js";import{_ as j,u as S,i as D}from"./index-CJP2_w2Y.js";import{f as M,i as P,b as A,d as H,a as O,c as $}from"./formatDate-DJT1dS-E.js";const F={class:"images"},L={class:"header"},N=j({__name:"Images",setup(j){const N=S(),Q=a([]),R=a(!1),q=a(1),B=a(10),E=a(0),G=a(""),J=a(!1),K=a({_id:"",remarks:"",orientation:"0"}),T={remarks:[{max:500,message:"备注不能超过500个字符",trigger:"blur"}]},V=async()=>{var a;R.value=!0,Q.value=[];try{const{data:a}=await D.post("/api/admin/images",u.stringify({page:q.value,limit:B.value,searchQuery:G.value}));E.value=a.total,Q.value.push(...a.images)}catch({response:e}){s.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}finally{R.value=!1}},W=()=>{q.value=1,V()},X=async()=>{var a;try{const{_id:a,remarks:e,orientation:l}=K.value;await D.patch(`/api/admin/images/${a}`,{remarks:e,orientation:parseInt(l)}),s.success("图片数据更新成功"),J.value=!1,V()}catch({response:e}){s.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}};return e(V),(a,e)=>{const u=n,j=m,S=_,Y=k,Z=y,aa=c,ea=i,la=d,oa=I,ra=C,ta=z,ua=U,sa=x,na=v;return p(),l("div",F,[o("div",L,[r(u,{value:G.value,"onUpdate:value":e[0]||(e[0]=a=>G.value=a),placeholder:"搜索文件名/MD5/SHA-1/备注/IP",style:{width:"275px"},onSearch:W,"allow-clear":""},null,8,["value"])]),r(ea,{spinning:R.value},{default:t((()=>[r(aa,{data:Q.value,"scrollbar-always-on":"",fit:""},{default:t((()=>{var a,o;return[r(S,{label:"预览",fixed:""},{default:t((({row:a})=>[r(j,{src:w(N).config.site.url+a.thumb,fallback:"local"===a.type?w(N).config.site.url+a.url:a.url,preview:{src:"local"==a.type?w(N).config.site.url+a.url:a.url}},null,8,["src","fallback","preview"])])),_:1}),r(S,{prop:"name","show-overflow-tooltip":"",label:"文件名"}),r(S,{prop:"md5","show-overflow-tooltip":"",label:"MD5"}),r(S,{prop:"sha1","show-overflow-tooltip":"",label:"SHA-1"}),r(S,{sortable:"",label:"大小"},{default:t((({row:a})=>[b(h(w(M)(a.size)),1)])),_:1}),r(S,{prop:"album",label:"相册"},{default:t((({row:a})=>{var e;return[b(h((null==(e=a.album)?void 0:e.name)||"独立图片"),1)]})),_:1}),r(S,{prop:"remarks","show-overflow-tooltip":"",label:"备注"},{default:t((({row:a})=>[b(h(a.remarks||"暂无备注"),1)])),_:1}),r(S,{label:"类型"},{default:t((({row:a})=>[b(h(w(P)[a.type]),1)])),_:1}),(null==(o=null==(a=w(N).config)?void 0:a.ai)?void 0:o.enabled)?(p(),l(g,{key:0},[r(S,{label:"健康状态"},{default:t((({row:a})=>{var e;return[r(Y,{color:null==(e=w(A)[a.safe])?void 0:e.color},{default:t((()=>{var e;return[b(h(null==(e=w(A)[a.safe])?void 0:e.text),1)]})),_:2},1032,["color"])]})),_:1}),r(S,{label:"检测结果"},{default:t((({row:a})=>{var e,l;return[r(Y,{color:w(H)[a.label]?null==(e=w(H)[a.label])?void 0:e.color:null==(l=w(A)[a.safe])?void 0:l.color},{default:t((()=>{var e;return[b(h(w(H)[a.label]?null==(e=w(H)[a.label])?void 0:e.text:a.label),1)]})),_:2},1032,["color"])]})),_:1})],64)):f("",!0),r(S,{"show-overflow-tooltip":"",label:"存储目录"},{default:t((({row:a})=>[b(h(a.filePath),1)])),_:1}),r(S,{label:"上传者"},{default:t((({row:a})=>[b(h(a.user?a.user.username:"游客"),1)])),_:1}),r(S,{prop:"ip","show-overflow-tooltip":"",label:"IP地址"}),r(S,{prop:"date",sortable:"","show-overflow-tooltip":"",label:"上传时间"},{default:t((({row:a})=>[b(h(w(O)(a.date)),1)])),_:1}),r(S,{label:"操作",fixed:"right",width:"150"},{default:t((({row:a})=>[r(Z,{type:"link",onClick:e=>w($)(e,a,w(N))},{default:t((()=>e[7]||(e[7]=[b("复制")]))),_:2,__:[7]},1032,["onClick"]),r(Z,{type:"link",onClick:e=>{return l=a,K.value=l,K.value.orientation="0",void(J.value=!0);var l}},{default:t((()=>e[8]||(e[8]=[b("编辑")]))),_:2,__:[8]},1032,["onClick"]),r(Z,{type:"link",danger:"",onClick:e=>{return l=a._id,void v.confirm({title:"确认删除",content:"确定要删除这张图片吗？",async onOk(){var a;try{await D.delete(`/api/admin/images/${l}`),s.success("删除成功"),V()}catch({response:e}){s.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}}});var l}},{default:t((()=>e[9]||(e[9]=[b("删除")]))),_:2,__:[9]},1032,["onClick"])])),_:1})]})),_:1},8,["data"])])),_:1},8,["spinning"]),r(la,{class:"pagination",current:q.value,"onUpdate:current":e[1]||(e[1]=a=>q.value=a),"page-size":B.value,"onUpdate:pageSize":e[2]||(e[2]=a=>B.value=a),total:E.value,"show-size-changer":"",onChange:V},null,8,["current","page-size","total"]),r(na,{open:J.value,"onUpdate:open":e[5]||(e[5]=a=>J.value=a),title:"编辑图片",onOk:X,onCancel:e[6]||(e[6]=a=>J.value=!1)},{default:t((()=>[r(sa,{model:K.value,rules:T,layout:"vertical"},{default:t((()=>[r(ra,{label:"备注",name:"remarks"},{default:t((()=>[r(oa,{value:K.value.remarks,"onUpdate:value":e[3]||(e[3]=a=>K.value.remarks=a),placeholder:"添加图片备注",rows:4,"show-count":"",maxlength:500},null,8,["value"])])),_:1}),r(ra,{label:"图片方向",name:"orientation"},{default:t((()=>[r(ua,{value:K.value.orientation,"onUpdate:value":e[4]||(e[4]=a=>K.value.orientation=a),style:{width:"100%"},disabled:"local"!==K.value.type},{default:t((()=>[r(ta,{value:"0"},{default:t((()=>e[10]||(e[10]=[b("原始方向")]))),_:1,__:[10]}),r(ta,{value:"90"},{default:t((()=>e[11]||(e[11]=[b("顺时针旋转90°")]))),_:1,__:[11]}),r(ta,{value:"-90"},{default:t((()=>e[12]||(e[12]=[b("逆时针旋转90°")]))),_:1,__:[12]}),r(ta,{value:"180"},{default:t((()=>e[13]||(e[13]=[b("旋转180°")]))),_:1,__:[13]}),r(ta,{value:"270"},{default:t((()=>e[14]||(e[14]=[b("顺时针旋转270°")]))),_:1,__:[14]}),r(ta,{value:"-270"},{default:t((()=>e[15]||(e[15]=[b("逆时针旋转270°")]))),_:1,__:[15]})])),_:1},8,["value","disabled"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open"])])}}},[["__scopeId","data-v-12dc87f5"]]);export{N as default};
