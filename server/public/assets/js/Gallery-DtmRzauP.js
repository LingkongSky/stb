import{_ as a,u as e,i as l}from"./index-B0llsXYu.js";import{r as s,o as t,e as u,f as i,g as o,h as n,a0 as v,k as r,m,i as g,a1 as d,j as c,F as p,x as f,a2 as y,p as h,a3 as _,a4 as k,I as w,a5 as b,a6 as x,a7 as I,v as V}from"./vendor-DLaggKmm.js";import{e as j}from"./404-D23t8Jcl.js";import{_ as C}from"./ImageInfoModal-mDjc-_Bp.js";import"./formatDate-DJT1dS-E.js";const P={class:"gallery-container"},U={style:{"margin-bottom":"20px","text-align":"center"}},D={class:"gallery-content"},K={key:0,class:"loading-more"},z={class:"image-item-tags"},M=["src"],F=["src"],G=a({__name:"Gallery",setup(a){const G=e(),q=s([]),A=s(1),B=s(0),E=s(!1),H=s(!1),J=s(!1),L=s({}),N=s(0),O={1920:{rowPerView:5},1200:{rowPerView:4},800:{rowPerView:3},500:{rowPerView:2}},Q=s([]),R=async()=>{var a;if(!(!E.value&&q.value.length>=B.value&&B.value>0)){E.value=!0,H.value=!1;try{const{data:a}=await l.post("/api/images",k.stringify({page:A.value,limit:20,tags:Q.value}));B.value=a.total,1===A.value?q.value=a.images:q.value.push(...a.images),A.value++,0===q.value.length&&0===B.value&&0===Q.value.length?H.value=!0:H.value=!1}catch({response:e}){w.error(null==(a=null==e?void 0:e.data)?void 0:a.error),H.value=!0}finally{E.value=!1}}},S=()=>{A.value=1,B.value=0,q.value=[],R()};return t((()=>{A.value=1,R()})),(a,e)=>{const l=v,s=y,t=d,k=I,w=b,A=_;return i(),u("div",P,[o("div",U,[n(l,{value:Q.value,"onUpdate:value":e[0]||(e[0]=a=>Q.value=a),mode:"tags",style:{width:"300px"},placeholder:"按标签搜索",onChange:S},null,8,["value"])]),o("div",D,[n(A,{loading:E.value,"item-layout":"horizontal","data-source":q.value},{loadMore:r((()=>[!E.value&&q.value.length<B.value?(i(),u("div",K,[n(s,{class:"loading-more-button",onClick:R},{default:r((()=>e[4]||(e[4]=[h("加载更多")]))),_:1,__:[4]})])):g("",!0)])),default:r((()=>[q.value.length?(i(),m(c(x),{key:0,list:q.value,animationDuration:100,animationDelay:100,breakpoints:O},{default:r((({item:a,index:e})=>[n(t,{src:c(G).config.site.url+a.thumb,preview:{visible:!1},onClick:l=>((a,e)=>{L.value=a,J.value=!0,N.value=e})(a,e)},null,8,["src","onClick"]),o("div",z,[(i(!0),u(p,null,f(a.tags,(a=>(i(),m(k,{key:a,size:"small",onClick:e=>(a=>{Q.value.push(a),S()})(a)},{default:r((()=>[h(V(a),1)])),_:2},1032,["onClick"])))),128))])])),_:1},8,["list"])):H.value&&!E.value?(i(),m(w,{key:1,title:"图片广场空空如也","sub-title":"快来上传你的第一张图片吧~"},{icon:r((()=>[o("img",{src:c(j),class:"ant-result-icon ant-result-image"},null,8,M)])),_:1})):0===q.value.length&&!E.value&&Q.value.length>0?(i(),m(w,{key:2,title:"没有找到匹配的图片","sub-title":"请尝试其他标签"},{icon:r((()=>[o("img",{src:c(j),class:"ant-result-icon ant-result-image"},null,8,F)])),_:1})):g("",!0)])),_:1},8,["loading","data-source"]),n(C,{modelValue:J.value,"onUpdate:modelValue":e[1]||(e[1]=a=>J.value=a),imageInfo:L.value,"onUpdate:imageInfo":e[2]||(e[2]=a=>L.value=a),imageKey:N.value,"onUpdate:imageKey":e[3]||(e[3]=a=>N.value=a),images:q.value},null,8,["modelValue","imageInfo","imageKey","images"])])])}}},[["__scopeId","data-v-7ddb08ad"]]);export{G as default};
