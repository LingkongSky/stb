import{r as e,a8 as a,o as l,e as u,h as t,k as d,I as r,au as o,f as i,g as n,m as p,a2 as v,p as s,aM as c,aN as m,a7 as f,v as _,j as k,aQ as b,ay as h,am as y,i as w,an as x,ao as g,aR as U,aU as q,aT as C,a0 as D,F as A,x as j,ax as G,V as L,W as R,a$ as F,b0 as I,b1 as O,aW as W,aX as H,aK as M,a1 as S}from"./vendor-DLaggKmm.js";import{_ as z,u as K,i as $}from"./index-B0llsXYu.js";import{i as B,a as T,e as Y}from"./formatDate-DJT1dS-E.js";const N={class:"role-groups-container"},Q={class:"header"},V=z({__name:"RoleGroups",setup(z){const V=K(),X=e(!1),E=e(!1),J=e(!1),P=e(null),Z=e([]),ee=e(""),ae=e([]),le=Object.entries(B).filter((([e])=>"get"!==e)).map((([e,a])=>({value:e,label:a}))),ue=e({name:"",description:"",isAdmin:!1,isDefault:!1,isGuest:!1,upload:{}}),te=a((()=>{const e={northwest:"左上",west:"左中",southwest:"左下",northeast:"右上",east:"右中",southeast:"右下",north:"上中",center:"居中",south:"下中"};return Object.keys(e).map((a=>({key:a,value:e[a]})))})),de=[{label:"变量",prop:"variable"},{label:"说明",prop:"description"},{label:"示例",prop:"example"}],re=[{variable:"{Y}",description:"年份（4位）",example:"2024"},{variable:"{y}",description:"年份（2位）",example:"24"},{variable:"{m}",description:"月份",example:"03"},{variable:"{d}",description:"日期",example:"15"},{variable:"{Ymd}",description:"年月日",example:"20240315"},{variable:"{filename}",description:"原始文件名",example:"image"},{variable:"{ext}",description:"文件扩展名",example:"jpg"},{variable:"{time}",description:"时间戳",example:"1748695143942"},{variable:"{uniqid}",description:"唯一ID",example:"a1b2c3d4"},{variable:"{md5}",description:"文件MD5值",example:"d41d8cd98f00b204e9800998ecf8427e"},{variable:"{sha1}",description:"文件SHA1值",example:"da39a3ee5e6b4b0d3255bfef95601890afd80709"},{variable:"{uuid}",description:"UUID",example:"550e8400-e29b-41d4-a716-446655440000"},{variable:"{uid}",description:"用户ID（仅登录用户）",example:"123456"}],oe=async(e,a)=>{var l;try{ue.value=a?Z.value.find((a=>a._id===e)):{name:"",description:"",isAdmin:!1,isDefault:!1,isGuest:!1,upload:{}},P.value=a,J.value=!0}catch({response:u}){r.error(null==(l=null==u?void 0:u.data)?void 0:l.error)}},ie=async()=>{var e;X.value=!0;try{const{data:e}=await $.post("/api/admin/role-groups");Z.value=e}catch({response:a}){r.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}finally{X.value=!1}},ne=async()=>{var e;E.value=!0;try{P.value?(await $.put(`/api/admin/role-groups/${ue.value._id}`,ue.value),r.success("更新成功")):(await $.post("/api/admin/role-groups/create",ue.value),r.success("创建成功")),J.value=!1,ie()}catch({response:a}){r.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}finally{E.value=!1}},pe=async e=>{var a;try{const a=new FormData;a.append("image",e),a.append("id",ue.value._id);const{data:l}=await $.post("/api/admin/upload-watermark",a);return ue.value.watermark.image.path=l.path,r.success("水印图片上传成功"),!1}catch({response:l}){return r.error(null==(a=null==l?void 0:l.data)?void 0:a.error),!1}},ve=async()=>{var e;try{await $.delete(`/api/admin/delete-watermark/${encodeURIComponent(ue.value.watermark.image.path)}`),ue.value.watermark.image.path="",r.success("水印图片删除成功")}catch({response:a}){r.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}};return l((()=>{ie()})),(e,a)=>{const l=v,z=m,K=f,B=b,se=c,ce=g,me=x,fe=U,_e=q,ke=C,be=G,he=D,ye=I,we=F,xe=O,ge=R,Ue=L,qe=H,Ce=W,De=M,Ae=S,je=y,Ge=h,Le=o;return i(),u("div",N,[t(Le,{spinning:X.value},{default:d((()=>[n("div",Q,[t(l,{type:"primary",onClick:a[0]||(a[0]=e=>oe("",!1))},{default:d((()=>a[35]||(a[35]=[s("创建角色组")]))),_:1,__:[35]})]),t(se,{data:Z.value,"scrollbar-always-on":"",fit:""},{default:d((()=>[t(z,{prop:"name",label:"名称",fixed:""}),t(z,{prop:"description",label:"描述"}),t(z,{label:"管理组"},{default:d((({row:e})=>[t(K,{color:e.isAdmin?"green":"default"},{default:d((()=>[s(_(e.isAdmin?"是":"否"),1)])),_:2},1032,["color"])])),_:1}),t(z,{label:"默认组"},{default:d((({row:e})=>[t(K,{color:e.isDefault?"green":"default"},{default:d((()=>[s(_(e.isDefault?"是":"否"),1)])),_:2},1032,["color"])])),_:1}),t(z,{label:"游客组"},{default:d((({row:e})=>[t(K,{color:e.isGuest?"green":"default"},{default:d((()=>[s(_(e.isGuest?"是":"否"),1)])),_:2},1032,["color"])])),_:1}),t(z,{prop:"maxCapacity",sortable:"",label:"可用容量"},{default:d((({row:e})=>[s(_(e.maxCapacity)+"MB",1)])),_:1}),t(z,{prop:"createdAt",sortable:"",label:"创建时间"},{default:d((({row:e})=>[s(_(k(T)(e.createdAt)),1)])),_:1}),t(z,{prop:"updatedAt",sortable:"",label:"编辑时间"},{default:d((({row:e})=>[s(_(k(T)(e.updatedAt)),1)])),_:1}),t(z,{label:"操作",fixed:"right"},{default:d((({row:e})=>[t(l,{type:"link",onClick:a=>oe(e._id,!0)},{default:d((()=>a[36]||(a[36]=[s("编辑")]))),_:2,__:[36]},1032,["onClick"]),t(B,{title:"确定要删除这个角色组吗？",onConfirm:a=>(async e=>{var a;try{await $.delete(`/api/admin/role-groups/${e._id}`),r.success("删除成功"),ie()}catch({response:l}){r.error(null==(a=null==l?void 0:l.data)?void 0:a.error)}})(e)},{default:d((()=>[t(l,{type:"link",danger:""},{default:d((()=>a[37]||(a[37]=[s("删除")]))),_:1,__:[37]})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"]),(i(),p(Ge,{class:"RoleGroups-model",open:J.value,"onUpdate:open":a[34]||(a[34]=e=>J.value=e),title:P.value?"编辑角色组":"创建角色组",onOk:ne,confirmLoading:E.value,key:J.value},{default:d((()=>[t(je,{model:ue.value,layout:"vertical"},{default:d((()=>[t(me,{label:"名称",required:""},{default:d((()=>[t(ce,{value:ue.value.name,"onUpdate:value":a[1]||(a[1]=e=>ue.value.name=e),"show-count":"",maxlength:10,placeholder:"输入角色组名称"},null,8,["value"])])),_:1}),t(me,{label:"描述"},{default:d((()=>[t(fe,{value:ue.value.description,"onUpdate:value":a[2]||(a[2]=e=>ue.value.description=e),"show-count":"",maxlength:20,placeholder:"输入角色组描述"},null,8,["value"])])),_:1}),t(me,{label:"是否为管理组"},{default:d((()=>[t(_e,{checked:ue.value.isAdmin,"onUpdate:checked":a[3]||(a[3]=e=>ue.value.isAdmin=e)},null,8,["checked"])])),_:1}),t(me,{label:"是否为默认组"},{default:d((()=>[t(_e,{checked:ue.value.isDefault,"onUpdate:checked":a[4]||(a[4]=e=>ue.value.isDefault=e)},null,8,["checked"])])),_:1}),t(me,{label:"是否为游客组"},{default:d((()=>[t(_e,{checked:ue.value.isGuest,"onUpdate:checked":a[5]||(a[5]=e=>ue.value.isGuest=e)},null,8,["checked"])])),_:1}),ue.value.isGuest?w("",!0):(i(),p(me,{key:0,label:"可用容量(MB)",required:""},{default:d((()=>[t(ke,{style:{width:"100%"},value:ue.value.maxCapacity,"onUpdate:value":a[6]||(a[6]=e=>ue.value.maxCapacity=e)},null,8,["value"]),a[38]||(a[38]=n("p",null,"该设置项在游客组下无效",-1))])),_:1,__:[38]})),t(me,{label:"存储类型"},{default:d((()=>[t(he,{value:ue.value.upload.storageType,"onUpdate:value":a[7]||(a[7]=e=>ue.value.upload.storageType=e)},{default:d((()=>[(i(!0),u(A,null,j(k(le),((e,a)=>(i(),p(be,{value:e.value,key:a},{default:d((()=>[s(_(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),t(Ue,{activeKey:ee.value,"onUpdate:activeKey":a[33]||(a[33]=e=>ee.value=e)},{default:d((()=>[t(ge,{key:"1",header:"上传设置"},{default:d((()=>[t(me,{label:"允许的图片格式",required:""},{default:d((()=>[t(he,{value:ue.value.upload.allowedFormats,"onUpdate:value":a[8]||(a[8]=e=>ue.value.upload.allowedFormats=e),mode:"multiple",placeholder:"选择允许的图片格式"},{default:d((()=>[(i(!0),u(A,null,j(k(Y),(e=>(i(),p(be,{value:e,key:e},{default:d((()=>[s(_(e.toUpperCase()),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),t(me,{label:"最大文件大小(MB)",required:""},{default:d((()=>[t(ke,{style:{width:"100%"},value:ue.value.upload.maxSize,"onUpdate:value":a[9]||(a[9]=e=>ue.value.upload.maxSize=e),min:1,max:100},null,8,["value"])])),_:1}),t(me,{label:"最多同时上传图片数量",required:""},{default:d((()=>[t(ke,{style:{width:"100%"},value:ue.value.upload.concurrentUploads,"onUpdate:value":a[10]||(a[10]=e=>ue.value.upload.concurrentUploads=e),min:1},null,8,["value"])])),_:1}),t(we,{gutter:16},{default:d((()=>[t(ye,{span:12},{default:d((()=>[t(me,{label:"最小宽度(px)",required:""},{default:d((()=>[t(ke,{value:ue.value.upload.minWidth,"onUpdate:value":a[11]||(a[11]=e=>ue.value.upload.minWidth=e),min:0},null,8,["value"])])),_:1})])),_:1}),t(ye,{span:12},{default:d((()=>[t(me,{label:"最小高度(px)",required:""},{default:d((()=>[t(ke,{value:ue.value.upload.minHeight,"onUpdate:value":a[12]||(a[12]=e=>ue.value.upload.minHeight=e),min:0},null,8,["value"])])),_:1})])),_:1})])),_:1}),t(we,{gutter:16},{default:d((()=>[t(ye,{span:12},{default:d((()=>[t(me,{label:"最大宽度(px)",required:""},{default:d((()=>[t(ke,{value:ue.value.upload.maxWidth,"onUpdate:value":a[13]||(a[13]=e=>ue.value.upload.maxWidth=e),min:0},null,8,["value"])])),_:1})])),_:1}),t(ye,{span:12},{default:d((()=>[t(me,{label:"最大高度(px)",required:""},{default:d((()=>[t(ke,{value:ue.value.upload.maxHeight,"onUpdate:value":a[14]||(a[14]=e=>ue.value.upload.maxHeight=e),min:0},null,8,["value"])])),_:1})])),_:1})])),_:1}),t(me,{label:"转换格式",required:""},{default:d((()=>[t(he,{value:ue.value.upload.convertFormat,"onUpdate:value":a[15]||(a[15]=e=>ue.value.upload.convertFormat=e),allowClear:"",placeholder:"选择转换格式"},{default:d((()=>[t(be,{value:""},{default:d((()=>a[39]||(a[39]=[s("不转换")]))),_:1,__:[39]}),(i(!0),u(A,null,j(k(Y),(e=>(i(),p(be,{value:e,key:e},{default:d((()=>[s(_(e.toUpperCase()),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),t(me,{label:"图片压缩",required:""},{default:d((()=>[t(_e,{checked:ue.value.upload.qualityOpen,"onUpdate:checked":a[16]||(a[16]=e=>ue.value.upload.qualityOpen=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),ue.value.upload.qualityOpen?(i(),p(me,{key:0,label:"图片质量",required:""},{default:d((()=>[t(xe,{value:ue.value.upload.quality,"onUpdate:value":a[17]||(a[17]=e=>ue.value.upload.quality=e),min:1,max:100,marks:{1:"1%",25:"25%",50:"50%",75:"75%",100:"100%"}},null,8,["value"])])),_:1})):w("",!0),t(me,{label:"每日上传限制",required:""},{default:d((()=>[t(ke,{style:{width:"100%"},value:ue.value.upload.dailyLimit,"onUpdate:value":a[18]||(a[18]=e=>ue.value.upload.dailyLimit=e),min:0,placeholder:"0表示不限制"},null,8,["value"]),a[40]||(a[40]=n("p",null,"该功能仅限制已登录用户, 游客模式下无效",-1))])),_:1,__:[40]}),t(me,{label:"文件目录命名规则",required:""},{default:d((()=>[t(ce,{value:ue.value.upload.catalogue,"onUpdate:value":a[19]||(a[19]=e=>ue.value.upload.catalogue=e),placeholder:"输入文件目录命名规则"},null,8,["value"]),a[41]||(a[41]=n("p",null,'目录命名规则不能以"/"结尾, 不能包含"\\"',-1))])),_:1,__:[41]}),t(me,{label:"文件名命名规则",required:""},{default:d((()=>[t(ce,{value:ue.value.upload.namingRule,"onUpdate:value":a[20]||(a[20]=e=>ue.value.upload.namingRule=e),placeholder:"输入文件命名规则"},null,8,["value"]),a[42]||(a[42]=n("p",null,'文件名命名规则中不能含有"/"和"\\"',-1)),a[43]||(a[43]=n("p",null,'如果设置了"格式转换", 文件后缀将以"转换后"的格式为准',-1))])),_:1,__:[42,43]}),t(Ue,{class:"namingRule-collapse"},{default:d((()=>[t(ge,{header:"支持的命名规则"},{default:d((()=>[t(se,{data:re},{default:d((()=>[(i(),u(A,null,j(de,((e,a)=>t(z,{prop:e.prop,label:e.label,key:a},null,8,["prop","label"]))),64))])),_:1})])),_:1})])),_:1})])),_:1}),t(ge,{key:"2",header:"水印设置"},{default:d((()=>[t(me,null,{default:d((()=>[t(_e,{checked:ue.value.watermark.enabled,"onUpdate:checked":a[21]||(a[21]=e=>ue.value.watermark.enabled=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])])),_:1}),ue.value.watermark.enabled?(i(),u(A,{key:0},[t(me,{label:"水印类型"},{default:d((()=>[t(Ce,{value:ue.value.watermark.type,"onUpdate:value":a[22]||(a[22]=e=>ue.value.watermark.type=e)},{default:d((()=>[t(qe,{value:"text"},{default:d((()=>a[44]||(a[44]=[s("文字水印")]))),_:1,__:[44]}),t(qe,{value:"image"},{default:d((()=>a[45]||(a[45]=[s("图片水印")]))),_:1,__:[45]})])),_:1},8,["value"])])),_:1}),"text"===ue.value.watermark.type?(i(),u(A,{key:0},[t(me,{label:"水印文字",required:""},{default:d((()=>[t(ce,{value:ue.value.watermark.text.content,"onUpdate:value":a[23]||(a[23]=e=>ue.value.watermark.text.content=e)},null,8,["value"])])),_:1}),t(me,{label:"字体大小",required:""},{default:d((()=>[t(ke,{style:{width:"100%"},value:ue.value.watermark.text.fontSize,"onUpdate:value":a[24]||(a[24]=e=>ue.value.watermark.text.fontSize=e),min:12,max:72},null,8,["value"])])),_:1}),t(me,{label:"字体颜色",required:""},{default:d((()=>[t(ce,{value:ue.value.watermark.text.color,"onUpdate:value":a[25]||(a[25]=e=>ue.value.watermark.text.color=e),type:"color"},null,8,["value"])])),_:1})],64)):(i(),u(A,{key:1},[t(me,{label:"上传水印"},{default:d((()=>[t(De,{fileList:ae.value,"onUpdate:fileList":a[26]||(a[26]=e=>ae.value=e),beforeUpload:pe,showUploadList:!1},{default:d((()=>[t(l,null,{default:d((()=>a[46]||(a[46]=[s("选择水印图片")]))),_:1,__:[46]})])),_:1},8,["fileList"])])),_:1}),ue.value.watermark.image.path?(i(),u(A,{key:0},[t(me,{label:"水印管理"},{default:d((()=>[t(l,{onClick:ve},{default:d((()=>a[47]||(a[47]=[s("删除水印图片")]))),_:1,__:[47]})])),_:1}),t(me,{label:"水印图片"},{default:d((()=>{var e,a,l;return[t(Ae,{src:(null==(l=null==(a=null==(e=k(V))?void 0:e.config)?void 0:a.site)?void 0:l.url)+ue.value.watermark.image.path},null,8,["src"])]})),_:1}),t(me,{label:"水印图片URL"},{default:d((()=>[t(ce,{value:ue.value.watermark.image.path,"onUpdate:value":a[27]||(a[27]=e=>ue.value.watermark.image.path=e),disabled:""},null,8,["value"])])),_:1})],64)):w("",!0)],64)),t(me,{label:"透明度",required:""},{default:d((()=>[t(xe,{value:ue.value.watermark[ue.value.watermark.type].opacity,"onUpdate:value":a[28]||(a[28]=e=>ue.value.watermark[ue.value.watermark.type].opacity=e),min:0,max:1,step:.1},null,8,["value"])])),_:1}),t(me,{label:"水印位置",required:""},{default:d((()=>[t(he,{value:ue.value.watermark[ue.value.watermark.type].position,"onUpdate:value":a[29]||(a[29]=e=>ue.value.watermark[ue.value.watermark.type].position=e)},{default:d((()=>[(i(!0),u(A,null,j(te.value,(e=>(i(),p(be,{value:e.key,key:e.key},{default:d((()=>[s(_(e.value),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),t(me,{label:"距顶部边缘的像素偏移"},{default:d((()=>[t(ke,{style:{width:"100%"},value:ue.value.watermark[ue.value.watermark.type].top,"onUpdate:value":a[30]||(a[30]=e=>ue.value.watermark[ue.value.watermark.type].top=e)},null,8,["value"]),a[48]||(a[48]=n("p",null,'设置之后将会覆盖"水印位置"设置项',-1))])),_:1,__:[48]}),t(me,{label:"距左边缘的像素偏移"},{default:d((()=>[t(ke,{style:{width:"100%"},value:ue.value.watermark[ue.value.watermark.type].left,"onUpdate:value":a[31]||(a[31]=e=>ue.value.watermark[ue.value.watermark.type].left=e)},null,8,["value"]),a[49]||(a[49]=n("p",null,'设置之后将会覆盖"水印位置"设置项',-1))])),_:1,__:[49]}),t(me,{label:"是否平铺水印"},{default:d((()=>[t(_e,{checked:ue.value.watermark.tile,"onUpdate:checked":a[32]||(a[32]=e=>ue.value.watermark.tile=e),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"]),a[50]||(a[50]=n("p",null,"本功能仅支持: jpg、jpeg、png 或 webp",-1)),a[51]||(a[51]=n("p",null,"开启后水印将会铺满整张图片",-1))])),_:1,__:[50,51]})],64)):w("",!0)])),_:1})])),_:1},8,["activeKey"])])),_:1},8,["model"])])),_:1},8,["open","title","confirmLoading"]))])),_:1},8,["spinning"])])}}},[["__scopeId","data-v-3433e702"]]);export{V as default};
