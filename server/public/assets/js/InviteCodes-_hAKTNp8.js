import{r as e,o as a,e as t,g as l,h as o,k as r,a4 as s,I as n,a2 as u,au as d,aw as i,ay as c,f as v,p,aM as m,aN as f,a7 as _,v as g,j as w,am as b,an as y,aT as h}from"./vendor-DLaggKmm.js";import{_ as k,i as C}from"./index-CJP2_w2Y.js";import{a as x}from"./formatDate-DJT1dS-E.js";const A={class:"invite-codes"},U={class:"header"},j=k({__name:"InviteCodes",setup(k){const j=e([]),z=e(!1),B=e(1),I=e(10),O=e(0),R=e(!1),L=e(null),T=e({count:1}),$={count:[{required:!0,message:"请输入生成数量",trigger:"blur"},{type:"number",min:1,max:100,message:"数量应在1-100之间",trigger:"blur"}]},q=async()=>{var e;z.value=!0;try{const{data:e}=await C.post("/api/admin/invite-codes",s.stringify({page:B.value,limit:I.value}));O.value=e.total,j.value=e.codes}catch({response:a}){n.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}finally{z.value=!1}},D=()=>{T.value={count:1},R.value=!0},E=async()=>{var e;try{await L.value.validate(),await C.post("/api/admin/invite-codes/generate",T.value),n.success("邀请码生成成功"),R.value=!1,q()}catch({response:a}){n.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}},F=async()=>{var e;try{const e=await C.get("/api/admin/invite-codes/export",{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data])),t=document.createElement("a");t.href=a,t.setAttribute("download","invite-codes.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch({response:a}){n.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}};return a(q),(e,a)=>{const s=u,k=f,M=_,N=m,S=d,G=i,H=h,J=y,K=b,P=c;return v(),t("div",A,[l("div",U,[o(s,{type:"primary",onClick:D},{default:r((()=>a[5]||(a[5]=[p("生成邀请码")]))),_:1,__:[5]}),o(s,{onClick:F,disabled:!j.value.length},{default:r((()=>a[6]||(a[6]=[p("导出邀请码")]))),_:1,__:[6]},8,["disabled"])]),o(S,{spinning:z.value},{default:r((()=>[o(N,{data:j.value,"scrollbar-always-on":"",fit:""},{default:r((()=>[o(k,{prop:"code",label:"邀请码"}),o(k,{prop:"status",label:"状态"},{default:r((({row:e})=>[o(M,{color:"unused"===e.status?"green":"blue"},{default:r((()=>[p(g("unused"===e.status?"未使用":"已使用"),1)])),_:2},1032,["color"])])),_:1}),o(k,{prop:"usedBy","show-overflow-tooltip":"",label:"使用人"},{default:r((({row:e})=>[p(g(e.usedBy?e.usedBy.username:"-"),1)])),_:1}),o(k,{prop:"usedAt",sortable:"","show-overflow-tooltip":"",label:"使用时间"},{default:r((({row:e})=>[p(g(e.usedAt?w(x)(e.usedAt):"-"),1)])),_:1}),o(k,{prop:"createdAt",sortable:"","show-overflow-tooltip":"",label:"生成时间"},{default:r((({row:e})=>[p(g(w(x)(e.createdAt)),1)])),_:1}),o(k,{label:"操作",fixed:"right",width:"100"},{default:r((({row:e})=>[o(s,{type:"link",danger:"",onClick:a=>{return t=e,void c.confirm({title:"确认删除",content:`确定要删除邀请码 "${t.code}" 吗？`,async onOk(){var e;try{await C.delete(`/api/admin/invite-codes/${t._id}`),n.success("邀请码已删除"),q()}catch({response:a}){n.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}}});var t}},{default:r((()=>a[7]||(a[7]=[p("删除")]))),_:2,__:[7]},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["spinning"]),o(G,{class:"pagination",current:B.value,"onUpdate:current":a[0]||(a[0]=e=>B.value=e),"page-size":I.value,"onUpdate:pageSize":a[1]||(a[1]=e=>I.value=e),total:O.value,"show-size-changer":"",onChange:q},null,8,["current","page-size","total"]),o(P,{open:R.value,"onUpdate:open":a[3]||(a[3]=e=>R.value=e),title:"生成邀请码",onOk:E,onCancel:a[4]||(a[4]=e=>R.value=!1)},{default:r((()=>[o(K,{model:T.value,rules:$,ref_key:"generateFormRef",ref:L},{default:r((()=>[o(J,{label:"生成数量",name:"count"},{default:r((()=>[o(H,{value:T.value.count,"onUpdate:value":a[2]||(a[2]=e=>T.value.count=e),min:1,max:100,placeholder:"请输入生成数量"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open"])])}}},[["__scopeId","data-v-ec1c92ae"]]);export{j as default};
