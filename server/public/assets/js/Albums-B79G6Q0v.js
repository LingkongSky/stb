import{r as a,o as e,e as l,g as u,h as r,k as t,a4 as o,I as s,aL as n,a2 as i,au as v,ay as d,f as p,a0 as c,ax as m,p as f,aM as _,aN as b,v as h,j as w,aw as y,am as g,m as k,i as C,an as I,ao as U}from"./vendor-DLaggKmm.js";import{_ as S,i as x}from"./index-B0llsXYu.js";import{a as A}from"./formatDate-DJT1dS-E.js";const j={class:"admin-albums"},z={class:"search-area"},q=S({__name:"Albums",setup(S){const q=a([]),O=a(!1),$=a(!1),B=a("create"),D=a(null),L=a(!1),M=a([]),N=a(""),R=a(""),E=a(""),F=a(1),G=a(0),H=a(10),J=a({userId:void 0,name:"",permission:"private"}),K={userId:[{required:!0,message:"请选择用户"}],name:[{required:!0,message:"请输入相册名称"}],permission:[{required:!0,message:"请选择权限"}]},P=async()=>{var a;O.value=!0;try{const{data:a}=await x.post("/api/admin/albums",o.stringify({page:F.value,limit:H.value,name:R.value,username:N.value,permission:E.value}));q.value=a.albums,G.value=a.total}catch({response:e}){s.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}finally{O.value=!1}},Q=async a=>{var e;if(a){L.value=!0;try{const{data:e}=await x.post("/api/admin/users/search",o.stringify({username:a}));M.value=e.users}catch({response:l}){s.error(null==(e=null==l?void 0:l.data)?void 0:e.error)}finally{L.value=!1}}},T=()=>{B.value="create",J.value={userId:void 0,name:"",permission:"private"},$.value=!0},V=async()=>{var a;try{"create"===B.value?(await x.post("/api/admin/albums/new",J.value),s.success("创建相册成功")):(await x.put(`/api/admin/albums/${J.value._id}`,J.value),s.success("更新相册成功")),$.value=!1,P()}catch({response:e}){s.error(null==(a=null==e?void 0:e.data)?void 0:a.error)}};return e(P),(a,e)=>{const o=n,S=m,W=c,X=i,Y=b,Z=_,aa=y,ea=v,la=I,ua=U,ra=g,ta=d;return p(),l("div",j,[u("div",z,[r(o,{value:N.value,"onUpdate:value":e[0]||(e[0]=a=>N.value=a),allowClear:"",placeholder:"输入用户名搜索",onSearch:P},null,8,["value"]),r(o,{value:R.value,"onUpdate:value":e[2]||(e[2]=a=>R.value=a),allowClear:"",placeholder:"输入相册名称",onSearch:P},{addonBefore:t((()=>[r(W,{value:E.value,"onUpdate:value":e[1]||(e[1]=a=>E.value=a)},{default:t((()=>[r(S,{value:""},{default:t((()=>e[9]||(e[9]=[f("全部")]))),_:1,__:[9]}),r(S,{value:"public"},{default:t((()=>e[10]||(e[10]=[f("公开")]))),_:1,__:[10]}),r(S,{value:"private"},{default:t((()=>e[11]||(e[11]=[f("私有")]))),_:1,__:[11]})])),_:1},8,["value"])])),_:1},8,["value"]),r(X,{type:"primary",onClick:T},{default:t((()=>e[12]||(e[12]=[f("新建相册")]))),_:1,__:[12]})]),r(ea,{spinning:O.value},{default:t((()=>[r(Z,{data:q.value,"scrollbar-always-on":"",fit:""},{default:t((()=>[r(Y,{prop:"name","show-overflow-tooltip":"",label:"相册名称"}),r(Y,{label:"所属用户"},{default:t((({row:a})=>[f(h(a.user.username),1)])),_:1}),r(Y,{label:"权限"},{default:t((({row:a})=>[f(h("public"===a.permission?"公开":"私有"),1)])),_:1}),r(Y,{prop:"imageCount",sortable:"",label:"图片数量"}),r(Y,{prop:"createdAt","show-overflow-tooltip":"",sortable:"",label:"创建时间"},{default:t((({row:a})=>[f(h(w(A)(a.createdAt)),1)])),_:1}),r(Y,{prop:"updatedAt","show-overflow-tooltip":"",sortable:"",label:"最后修改时间"},{default:t((({row:a})=>[f(h(w(A)(a.updatedAt)),1)])),_:1}),r(Y,{label:"操作",fixed:"right"},{default:t((({row:a})=>[r(X,{type:"link",onClick:e=>{return l=a,B.value="edit",J.value={...l,userId:l.user._id},void($.value=!0);var l}},{default:t((()=>e[13]||(e[13]=[f("编辑")]))),_:2,__:[13]},1032,["onClick"]),r(X,{type:"link",danger:"",onClick:e=>(async a=>{d.confirm({title:"确定要删除这个相册吗？",content:"删除相册不会删除相册内的图片的实际文件",async onOk(){var e;try{await x.delete(`/api/admin/albums/${a._id}`),s.success("删除相册成功"),P()}catch({response:l}){s.error(null==(e=null==l?void 0:l.data)?void 0:e.error)}}})})(a)},{default:t((()=>e[14]||(e[14]=[f("删除")]))),_:2,__:[14]},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r(aa,{class:"pagination",current:F.value,"onUpdate:current":e[3]||(e[3]=a=>F.value=a),pageSize:H.value,"onUpdate:pageSize":e[4]||(e[4]=a=>H.value=a),total:G.value,"show-size-changer":"",onChange:P},null,8,["current","pageSize","total"])])),_:1},8,["spinning"]),r(ta,{open:$.value,"onUpdate:open":e[8]||(e[8]=a=>$.value=a),title:"create"===B.value?"新建相册":"编辑相册",onOk:V},{default:t((()=>[r(ra,{model:J.value,rules:K,layout:"vertical",ref_key:"formRef",ref:D},{default:t((()=>["create"===B.value?(p(),k(la,{key:0,label:"用户",name:"userId"},{default:t((()=>[r(W,{value:J.value.userId,"onUpdate:value":e[5]||(e[5]=a=>J.value.userId=a),"show-search":"",placeholder:"请选择用户","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null,loading:L.value,options:M.value,onSearch:Q},null,8,["value","loading","options"])])),_:1})):C("",!0),r(la,{label:"相册名称",name:"name"},{default:t((()=>[r(ua,{value:J.value.name,"onUpdate:value":e[6]||(e[6]=a=>J.value.name=a),"show-count":"",maxlength:10,placeholder:"请输入相册名称"},null,8,["value"])])),_:1}),r(la,{label:"权限",name:"permission"},{default:t((()=>[r(W,{value:J.value.permission,"onUpdate:value":e[7]||(e[7]=a=>J.value.permission=a)},{default:t((()=>[r(S,{value:"public"},{default:t((()=>e[15]||(e[15]=[f("公开")]))),_:1,__:[15]}),r(S,{value:"private"},{default:t((()=>e[16]||(e[16]=[f("私有")]))),_:1,__:[16]})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title"])])}}},[["__scopeId","data-v-1bb8fe4b"]]);export{q as default};
