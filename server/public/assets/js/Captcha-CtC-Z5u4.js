import{_ as a,i as e}from"./index-B0llsXYu.js";import{r as t,e as s,f as c,g as n,m as r,j as o,aH as u,aI as l,h as d,p as i,aJ as v,v as p,ar as m,t as h,I as y}from"./vendor-DLaggKmm.js";const f={class:"drag-verify"},g={key:0,class:"text"},x={key:1,class:"text"},I=a(Object.assign({name:"Captcha"},{__name:"Captcha",props:{value:{type:Boolean,default:!1},successText:{type:String,default:"验证成功"},startText:{type:String,default:"请按住滑块，拖动到最右边"}},emits:["update:value","verify-success","update:captchaId"],setup(a,{emit:I}){const k=I,E=t(!1),T=t(null),_="ontouchstart"in document.documentElement,j=_?"touchmove":"mousemove",w=_?"touchend":"mouseup",L=async()=>{var a;T.value||await(async()=>{var a;try{const{data:a}=await e.post("/api/auth/captcha/generate");T.value=a.captchaId,k("update:captchaId",a.captchaId)}catch({response:t}){y.error(null==(a=null==t?void 0:t.data)?void 0:a.error)}})();try{const{data:a}=await e.post("/api/auth/captcha/verify",{captchaId:T.value,verifyResult:!0});a.isValid?(E.value=!0,k("update:value",!0),k("verify-success")):(y.error("验证失败"),X())}catch({response:t}){y.error(null==(a=null==t?void 0:t.data)?void 0:a.error),X()}},X=()=>{E.value=!1,k("update:value",!1),T.value=null,k("update:captchaId",null)},b=a=>{let e=0;const t=document.querySelector(".drag-verify .block"),s=a.clientX||a.touches[0].pageX,c=t.offsetWidth-40;if(E.value)return!1;const n=a=>{const n=a.clientX||a.touches[0].pageX;e=n-s,e<=0&&(e=0),e>=c-40&&(e=c),t.style.transition=".1s all",t.style.transform=`translate3d(${e}px, 0, 0)`},r=()=>{e!==c?(t.style.transition=".5s all",t.style.transform="translate3d(0, 0, 0)"):L(),document.removeEventListener(j,n),document.removeEventListener(w,r)};document.addEventListener(j,n),document.addEventListener(w,r)};return(e,t)=>(c(),s("div",f,[n("div",{class:h(["range",E.value?"success":""])},[n("div",{class:"block",onMousedown:b,onTouchstartPassive:b},[n("span",null,[E.value?(c(),r(o(u),{key:0})):(c(),r(o(l),{key:1}))])],32),E.value?(c(),s("span",g,[d(o(v)),i(" "+p(a.successText),1)])):(c(),s("span",x,[d(o(m)),i(" "+p(a.startText),1)]))],2)]))}}),[["__scopeId","data-v-7517e564"]]);export{I as C};
