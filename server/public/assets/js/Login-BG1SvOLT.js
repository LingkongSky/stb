import{a8 as a,al as l,e,f as o,h as n,k as u,am as s,m as d,i,an as t,ao as r,j as c,ap as v,a2 as p,p as h,F as f,g,$ as _,b as m,I as b,aq as k,U as y,ar as I,as as x,at as w}from"./vendor-DLaggKmm.js";import{_ as C,u as U,i as q}from"./index-B0llsXYu.js";import{C as $}from"./Captcha-CtC-Z5u4.js";const j={class:"login-container"},F={class:"anticon"},G=["src"],H=C({__name:"Login",setup(C){const H=m(),L=U(),Q=a((()=>{var a,l;return null==(l=null==(a=null==L?void 0:L.config)?void 0:a.site)?void 0:l.captcha})),A=l({username:"",password:"",captcha:!1,captchaId:""}),D=a((()=>{let a=!A.username||!A.password;return Q.value&&(a=a||!A.captcha||!A.captchaId),a})),P=async()=>{var a;try{const{data:a}=await q.post("/api/auth/login",{username:A.username,password:A.password,captchaId:A.captchaId});L.token=a.token,L.user=a.user,H.push("/"),b.success("登录成功")}catch({response:l}){b.error((null==(a=null==l?void 0:l.data)?void 0:a.error)||"登录失败")}},R=a=>{var l;const{oauth:e,site:o}=null==L?void 0:L.config;e.enabled?(null==(l=e[a])?void 0:l.enabled)?location.href=`${o.url}/oauth/${a}?redirectUrl=${encodeURIComponent(location.href)}`:b.error(`${a}登录功能未启用`):b.error("社会化登录功能未启用")};return(a,l)=>{const m=r,b=t,C=v,U=p,q=k,V=s,z=_;return o(),e("div",j,[n(z,{title:"登录",class:"login-box"},{default:u((()=>[n(V,{model:A,onFinish:P,layout:"vertical"},{default:u((()=>{var a,s,t,r,v,p,_,k,j,P,V,z,B,E,J,K,M,N,O,S,T,W,X,Y,Z,aa,la;return[n(b,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"}]},{default:u((()=>[n(m,{value:A.username,"onUpdate:value":l[0]||(l[0]=a=>A.username=a),placeholder:"请输入用户名"},{prefix:u((()=>[n(c(y))])),_:1},8,["value"])])),_:1}),n(b,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}]},{default:u((()=>[n(C,{value:A.password,"onUpdate:value":l[1]||(l[1]=a=>A.password=a),placeholder:"请输入密码"},{prefix:u((()=>[n(c(I))])),_:1},8,["value"])])),_:1}),Q.value?(o(),d(b,{key:0,label:"验证码",required:"",name:"captcha"},{default:u((()=>[n($,{value:A.captcha,"onUpdate:value":l[2]||(l[2]=a=>A.captcha=a),captchaId:A.captchaId,"onUpdate:captchaId":l[3]||(l[3]=a=>A.captchaId=a)},null,8,["value","captchaId"])])),_:1})):i("",!0),n(b,{class:"sin"},{default:u((()=>{var a,e,s,t;return[n(U,{type:"primary","html-type":"submit",block:!(null==(e=null==(a=c(L).config)?void 0:a.site)?void 0:e.register),disabled:D.value},{default:u((()=>l[9]||(l[9]=[h(" 登录账号 ")]))),_:1,__:[9]},8,["block","disabled"]),(null==(t=null==(s=c(L).config)?void 0:s.site)?void 0:t.register)?(o(),d(U,{key:0,onClick:l[4]||(l[4]=a=>c(H).push("/register"))},{default:u((()=>l[10]||(l[10]=[h("注册账号")]))),_:1,__:[10]})):i("",!0),n(U,{onClick:l[5]||(l[5]=a=>c(H).push("/reset-password"))},{default:u((()=>l[11]||(l[11]=[h("找回密码")]))),_:1,__:[11]})]})),_:1}),(null==(t=null==(s=null==(a=c(L))?void 0:a.config)?void 0:s.oauth)?void 0:t.enabled)?(o(),e(f,{key:1},[(null==(_=null==(p=null==(v=null==(r=c(L))?void 0:r.config)?void 0:v.oauth)?void 0:p.github)?void 0:_.enabled)||(null==(V=null==(P=null==(j=null==(k=c(L))?void 0:k.config)?void 0:j.oauth)?void 0:P.google)?void 0:V.enabled)||(null==(J=null==(E=null==(B=null==(z=c(L))?void 0:z.config)?void 0:B.oauth)?void 0:E.linuxdo)?void 0:J.enabled)?(o(),d(q,{key:0},{default:u((()=>l[12]||(l[12]=[h(" 或 ")]))),_:1,__:[12]})):i("",!0),(null==(O=null==(N=null==(M=null==(K=c(L))?void 0:K.config)?void 0:M.oauth)?void 0:N.github)?void 0:O.enabled)?(o(),d(U,{key:1,onClick:l[6]||(l[6]=a=>R("github"))},{default:u((()=>[n(c(x)),l[13]||(l[13]=h(" GitHub "))])),_:1,__:[13]})):i("",!0),(null==(X=null==(W=null==(T=null==(S=c(L))?void 0:S.config)?void 0:T.oauth)?void 0:W.google)?void 0:X.enabled)?(o(),d(U,{key:2,onClick:l[7]||(l[7]=a=>R("google"))},{default:u((()=>[n(c(w)),l[14]||(l[14]=h(" Google "))])),_:1,__:[14]})):i("",!0),(null==(la=null==(aa=null==(Z=null==(Y=c(L))?void 0:Y.config)?void 0:Z.oauth)?void 0:aa.linuxdo)?void 0:la.enabled)?(o(),d(U,{key:3,onClick:l[8]||(l[8]=a=>R("linuxdo"))},{default:u((()=>[g("span",F,[g("img",{class:"linuxdo",src:c("/assets/svg/linuxdo-CAlHVQQP.svg")},null,8,G)]),l[15]||(l[15]=h(" Linux Do "))])),_:1,__:[15]})):i("",!0)],64)):i("",!0)]})),_:1},8,["model"])])),_:1})])}}},[["__scopeId","data-v-f800b6a0"]]);export{H as default};
